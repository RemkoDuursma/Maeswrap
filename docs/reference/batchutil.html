<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Functions for MAESPA batch runs — maesparunall • Maeswrap</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Functions for MAESPA batch runs — maesparunall" />
<meta property="og:description" content="Functions for running MAESTRA/MAESPA with parameters read from a .csv file.
To make multiple runs, create a comma-separated file (.csv) with each row
corresponding to a set of parameter values to be used in a simulation.  Each
column is for a different parameter, with its first entry being the name of
the parameter (see Details below).  Also needed is a text file with
definitions, i.e. how parameter names in the .csv file correspond to
parameter names in one of the MAESTRA input files, which file it is, and in
which namelist to look (see Details).  See Examples below for useage, and
how to deal with the results from a batch run.  Note that the batch
utilities use the executable 'maespa.exe' (runmaespa), or 'maestra.exe'
(runmaestra) by default, but you can use others. See Examples on how to set
this.
Users will typically run maesparunall, which runs every row in the
comma-separated file denoted by runfile. Every column in this runfile
is named, with the name corresponding not directly to a parameter or
namelist in one of the fortran input files, but rather to an entry in the
definition file. This file (argument deffile) needs to be in the
current workspace. It is a space (or tab)-separated file, with four columns:
'parname', 'fileparname', 'filename' and 'namelist'. An example of this file
is provided with this package. Entries of each do not need to be quoted. The
namelist entry can be left blank, but it is recommended to provide the
namelist where the parameter occurs, for reliability.
The default executable is maespa.exe when running runmaespa,
but others can of course be used.  The function runmaestra is exactly
the same as runmaespa, except that the default is to use the
executable 'maestra.exe'. To set the default for the rest of the session,
see the last Example below.
Note that these functions should be general, in that they can be used for
any Fortran compiled program (.exe) that reads parameters from namelists.
By default, Maes(tra/pa) reads and saves the 'hrflux.dat' and 'dayflux.dat'
files, and the 'watbal.dat' if it exists (i.e., if Maespa was used for the
simulation). The 'extrafiles' argument specified additional output files to
read and store." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Maeswrap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.8.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Functions for MAESPA batch runs</h1>
    
    <div class="hidden name"><code>batchutil.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Functions for running MAESTRA/MAESPA with parameters read from a .csv file.
To make multiple runs, create a comma-separated file (.csv) with each row
corresponding to a set of parameter values to be used in a simulation.  Each
column is for a different parameter, with its first entry being the name of
the parameter (see Details below).  Also needed is a text file with
definitions, i.e. how parameter names in the .csv file correspond to
parameter names in one of the MAESTRA input files, which file it is, and in
which namelist to look (see Details).  See Examples below for useage, and
how to deal with the results from a batch run.  Note that the batch
utilities use the executable 'maespa.exe' (runmaespa), or 'maestra.exe'
(runmaestra) by default, but you can use others. See Examples on how to set
this.</p>
<p>Users will typically run <code>maesparunall</code>, which runs every row in the
comma-separated file denoted by <code>runfile</code>. Every column in this runfile
is named, with the name corresponding not directly to a parameter or
namelist in one of the fortran input files, but rather to an entry in the
definition file. This file (argument <code>deffile</code>) needs to be in the
current workspace. It is a space (or tab)-separated file, with four columns:
'parname', 'fileparname', 'filename' and 'namelist'. An example of this file
is provided with this package. Entries of each do not need to be quoted. The
namelist entry can be left blank, but it is recommended to provide the
namelist where the parameter occurs, for reliability.</p>
<p>The default executable is <code>maespa.exe</code> when running <code>runmaespa</code>,
but others can of course be used.  The function <code>runmaestra</code> is exactly
the same as <code>runmaespa</code>, except that the default is to use the
executable 'maestra.exe'. To set the default for the rest of the session,
see the last Example below.</p>
<p>Note that these functions should be general, in that they can be used for
any Fortran compiled program (.exe) that reads parameters from namelists.</p>
<p>By default, Maes(tra/pa) reads and saves the 'hrflux.dat' and 'dayflux.dat'
files, and the 'watbal.dat' if it exists (i.e., if Maespa was used for the
simulation). The 'extrafiles' argument specified additional output files to
read and store.</p>
    </div>

    <pre class="usage"><span class='fu'>maesparunall</span>(<span class='kw'>whichrows</span> <span class='kw'>=</span> <span class='fl'>NA</span>, <span class='kw'>runfile</span> <span class='kw'>=</span> <span class='fl'>NA</span>, <span class='kw'>whichcols</span> <span class='kw'>=</span> <span class='fl'>NA</span>,
  <span class='kw'>quiet</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>extrafiles</span> <span class='kw'>=</span> <span class='st'>""</span>, <span class='no'>...</span>)

<span class='fu'>maestrarunall</span>(<span class='kw'>executable</span> <span class='kw'>=</span> <span class='st'>"maestra.exe"</span>, <span class='no'>...</span>)

<span class='fu'>runmaespa</span>(<span class='kw'>whichrow</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>whichcols</span> <span class='kw'>=</span> <span class='fl'>NA</span>, <span class='kw'>runfile</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/file.choose.html'>file.choose</a></span>(),
  <span class='kw'>runit</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>executable</span> <span class='kw'>=</span> <span class='st'>"maespa.exe"</span>,
  <span class='kw'>deffile</span> <span class='kw'>=</span> <span class='st'>"maeswrapdefinitions.txt"</span>, <span class='kw'>spinup</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>)

<span class='fu'>runmaestra</span>(<span class='kw'>executable</span> <span class='kw'>=</span> <span class='st'>"maestra.exe"</span>, <span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>whichrows</th>
      <td><p>Which rows of the runfile to run in the simulations?</p></td>
    </tr>
    <tr>
      <th>runfile</th>
      <td><p>Name of the runfile, needs to be a .csv file, quoted. If left
alone, a menu pops up.</p></td>
    </tr>
    <tr>
      <th>whichcols</th>
      <td><p>Which columns in the runfile contain parameters to be
changed in the simulations?</p></td>
    </tr>
    <tr>
      <th>quiet</th>
      <td><p>If TRUE, no progress is written to the console.</p></td>
    </tr>
    <tr>
      <th>extrafiles</th>
      <td><p>Additional files to read and store (See Details).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further parameters passed to <code>runmaespa</code> or <code>readPAR</code></p></td>
    </tr>
    <tr>
      <th>executable</th>
      <td><p>Name of the executable.</p></td>
    </tr>
    <tr>
      <th>whichrow</th>
      <td><p>For one run, which row to run?</p></td>
    </tr>
    <tr>
      <th>runit</th>
      <td><p>If FALSE, writes the input files but does not run the model.</p></td>
    </tr>
    <tr>
      <th>deffile</th>
      <td><p>Text file with definitions of parameter names in the input
files, their locations in files and namelists. See Details.</p></td>
    </tr>
    <tr>
      <th>spinup</th>
      <td><p>For Maespa only : if TRUE, the model is run once, and all
final values of soil water content and soil temperature are used to
initialize the next run, which is the run that is reported.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>For runmaespa, nothing is returned. Assuming you used runit=TRUE,
the model is run and output files are written to disk. The function
maesparunall returns a list with two components: daily and hourly. These
components are itself lists with each element a dataframe with the daily or
hourly results from the model output. These dataframes are read from the
files dayflux.dat and hrflux.dat.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>

<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {

<span class='co'>#-1. Run the second row of some csv file, using only entries in</span>
<span class='co'># columns 2, 3 and 4. Note that all column names in the .csv</span>
<span class='co'># file must be documented in the definition file, and that the</span>
<span class='co'># definition file must be in the current working directory!</span>
<span class='fu'>runmaespa</span>(<span class='fl'>2</span>, <span class='kw'>runfile</span><span class='kw'>=</span><span class='st'>"runfiletest.csv"</span>, <span class='kw'>runit</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>whichcols</span><span class='kw'>=</span><span class='fl'>2</span>:<span class='fl'>4</span>)

<span class='co'>#-2. Run all rows and all parameters from a comma-separated file.</span>
<span class='no'>runresults</span> <span class='kw'>&lt;-</span> <span class='fu'>maesparunall</span>(<span class='kw'>runfile</span><span class='kw'>=</span><span class='st'>"runfiletest.csv"</span>)

<span class='co'>#-3. Look at first run:</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>runresults</span>$<span class='no'>daily</span><span class='kw'>[[</span><span class='fl'>1</span>]])

<span class='co'>#-4. Summarize across runs with statements like these.</span>
<span class='co'># Sum net photosynthesis across runs:</span>
<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span>(<span class='no'>runresults</span>$<span class='no'>daily</span>, <span class='kw'>function</span>(<span class='no'>dfr</span>)<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>dfr</span>$<span class='no'>netPs</span>))

<span class='co'>#-5. Or write all results to disk:</span>
<span class='no'>filenames</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='st'>"MaespaDailyresults"</span>,<span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>runresults</span>$<span class='no'>daily</span>),<span class='st'>".txt"</span>,<span class='kw'>sep</span><span class='kw'>=</span><span class='st'>""</span>)
<span class='kw'>for</span>(<span class='no'>f</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>filenames</span>)){
    <span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span>(<span class='no'>runresults</span>$<span class='no'>daily</span><span class='kw'>[[</span><span class='no'>f</span>]],<span class='no'>filenames</span>[<span class='no'>f</span>],<span class='kw'>sep</span><span class='kw'>=</span><span class='st'>" "</span>,<span class='kw'>row.names</span><span class='kw'>=</span><span class='fl'>FALSE</span>)
}

<span class='co'>#-6. Use different executable:</span>
<span class='fu'>runmaespa</span>(<span class='kw'>executable</span><span class='kw'>=</span><span class='st'>"othermaestra.exe"</span>)

<span class='co'>#-7. Or set this other executable as the default for the rest of the session,</span>
<span class='co'># so that you only need to set it once (until you restart R anyway).</span>
<span class='fu'><a href='https://rdrr.io/r/base/formals.html'>formals</a></span>(<span class='no'>runmaespa</span>)$<span class='no'>executable</span> <span class='kw'>&lt;-</span> <span class='st'>"othermaestra.exe"</span>

<span class='co'>#-8. Specify additional output files to read and save:</span>
<span class='no'>myrun</span> <span class='kw'>&lt;-</span> <span class='fu'>maestrarunall</span>(<span class='kw'>runfile</span><span class='kw'>=</span><span class='st'>"myrunfile.csv"</span>, <span class='kw'>extrafiles</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"layflx.dat"</span>,<span class='st'>"resp.dat"</span>))
<span class='co'># These two files are then available in the 'myrun' list by names 'layflx' and 'resp'.</span>

}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Remko Duursma</p>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Remko Duursma.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


